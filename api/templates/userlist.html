{% extends "base.html" %}
{% block breadcrumbs %}
<li class="breadcrumb-item"><a href="#">User list</a></li>
{% endblock %}
{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/summary.css') }}">
{% endblock %}
{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script>
function add_user() {
  if (!$('#user_name').val() || ! $('#janelia_id').val()) {
    alert("You must enter a user name and Janelia ID");
    return;
  }
  url = '/adduser';
  token = $.cookie('assignment-manager-token');
  $.ajax({
    url: url,
    headers: {"Authorization": 'Bearer ' + token },
    type: 'POST',
    dataType: 'json',
    data: JSON.stringify({"name": $('#user_name').val(),
                          "janelia_id": $('#janelia_id').val()}),
    contentType:'application/json',
    success: function(result) {
      alert("This user has been added");
      window.location.href = '/userlist';
    },
    error: function (xhr, ajaxOptions, thrownError) {
      if (xhr.status == 401) {
        alert("You are not authenticated");
      }
      else if (xhr.status == 404) {
        alert("Janelia ID " + $('#janelia_id').val() + " is not in Workday");
      }
      else if (xhr.status == 400) {
        json = JSON.parse(xhr.responseText);
        alert(json['rest']['error']);
      }
      else {
        alert(xhr.status + ': ' + thrownError);
      }
    }
  });
}
</script>
{% endblock %}
{% block onload %}
onload="tableInitialize();"
{% endblock %}

{% block content %}
  {{navbar|safe}}
  <h3>Users</h3>
  <table id="users" class="tablesorter standard">
  <thead>
    <tr><th>User</th><th>Name</th><th>Janelia ID</th><th>Email</th><th>Organization</th><th>Permissions</th></tr>
  </thead>
  <tbody>
  {% for row in users %}
    <tr><td>{{row[0]}}</td><td>{{row[1]|safe}}</td><td>{{row[2]}}</td><td>{{row[3]}}</td><td>{{row[4]}}</td><td>{{row[5]}}</td></tr>
  {% endfor %}
  </tbody>
  </table>
  {{adduser|safe}}
{% endblock %}
